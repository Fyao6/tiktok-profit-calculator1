<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TikTokåˆ©æ¶¦è®¡ç®—å™¨ - æµ·å—è·¨å¢ƒçªå‡»å°åˆ†é˜Ÿ</title>
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’°</text></svg>">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root {
            --primary: #00ff88;
            --secondary: #1a1a1a;
            --accent: #ff0080;
            --success: #00ff88;
            --danger: #ff4444;
            --warning: #ffaa00;
            --dark-bg: #0a0a0a;
            --card-bg: #1a1a1a;
            --text-light: #ffffff;
            --text-muted: #888888;
            --border-color: #333333;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: 100%;
        }
        
        body {
            background-color: var(--dark-bg);
            color: var(--text-light);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.5;
            padding: 0;
            margin: 0;
            min-height: 100vh;
            padding-top: var(--safe-top);
            padding-bottom: var(--safe-bottom);
        }
        
        .container {
            max-width: 100%;
            padding: 12px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px 0;
            position: sticky;
            top: 0;
            background: var(--dark-bg);
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
        }
        
        .header h1 {
            color: var(--primary);
            font-size: 20px;
            font-weight: 700;
            margin: 0;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 15px;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 4px;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-weight: 600;
            font-size: 14px;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .tab.active {
            background: var(--primary);
            color: var(--dark-bg);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .section {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .section-title {
            color: var(--text-light);
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border-color);
            margin-left: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-label {
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
            font-size: 14px;
        }
        
        .input-field {
            width: 100%;
            padding: 16px;
            background-color: #334155;
            border: 2px solid #475569;
            border-radius: 8px;
            color: var(--text-light);
            font-size: 16px;
            transition: border-color 0.3s;
            -webkit-appearance: none;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .exchange-rate-display {
            background-color: var(--secondary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .rate-value {
            color: var(--primary);
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .rate-time {
            color: var(--text-muted);
            font-size: 12px;
        }
        
        .btn {
            padding: 16px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            width: 100%;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: var(--dark-bg);
        }
        
        .btn-primary:active {
            background-color: #00cc77;
        }
        
        .btn-secondary {
            background-color: var(--secondary);
            color: var(--text-light);
        }
        
        .btn-secondary:active {
            background-color: #2a2a2a;
        }
        
        .btn-accent {
            background-color: var(--accent);
            color: white;
        }
        
        .btn-accent:active {
            background-color: #e60073;
        }
        
        .converter-group {
            margin-bottom: 25px;
        }
        
        .converter-title {
            color: var(--accent);
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 16px;
        }
        
        .converter-result {
            margin-top: 12px;
            padding: 12px;
            background-color: var(--secondary);
            border-radius: 8px;
            font-weight: 700;
            text-align: center;
            font-size: 16px;
        }
        
        .result-primary {
            color: var(--primary);
        }
        
        .result-accent {
            color: var(--accent);
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .result-item {
            display: contents;
        }
        
        .result-label {
            color: var(--text-light);
            font-size: 14px;
            align-self: center;
        }
        
        .result-value {
            color: var(--text-light);
            font-weight: 700;
            text-align: right;
            font-size: 16px;
            align-self: center;
        }
        
        .result-value-secondary {
            color: var(--text-muted);
            text-align: right;
            font-size: 14px;
            align-self: center;
        }
        
        .profit-positive {
            color: var(--success);
        }
        
        .profit-negative {
            color: var(--danger);
        }
        
        .cost-breakdown {
            margin-bottom: 20px;
        }
        
        .cost-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }
        
        .cost-item:last-child {
            border-bottom: none;
        }
        
        .profit-level {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 700;
            font-size: 16px;
        }
        
        .profit-high {
            background-color: #064e3b;
            color: var(--success);
        }
        
        .profit-medium {
            background-color: #78350f;
            color: var(--warning);
        }
        
        .profit-low {
            background-color: #7f1d1d;
            color: var(--danger);
        }
        
        .advice-box {
            padding: 16px;
            background-color: var(--secondary);
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .manual-rate {
            display: flex;
            gap: 10px;
            margin-top: 12px;
            align-items: center;
        }
        
        .manual-rate input {
            flex: 1;
            padding: 12px;
        }
        
        .manual-rate button {
            width: auto;
            padding: 12px 16px;
            font-size: 14px;
            white-space: nowrap;
        }
        
        .divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 20px 0;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .section {
                padding: 16px;
            }
            
            .input-field, .btn {
                padding: 14px;
            }
            
            .result-grid {
                grid-template-columns: 1fr auto;
            }
            
            .result-value-secondary {
                display: none;
            }
        }
        
        /* æ¨ªå±ä¼˜åŒ– */
        @media (min-width: 768px) and (orientation: landscape) {
            .container {
                max-width: 700px;
            }
        }
        
        /* é˜²æ­¢iOSç¼©æ”¾ */
        input, select, textarea {
            font-size: 16px !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TikTokåˆ©æ¶¦è®¡ç®—å™¨</h1>
        </div>
        
        <!-- æ ‡ç­¾å¯¼èˆª -->
        <div class="tab-container">
            <button class="tab active" data-tab="calculator">åˆ©æ¶¦è®¡ç®—</button>
            <button class="tab" data-tab="converter">æ±‡ç‡æ¢ç®—</button>
        </div>
        
        <!-- åˆ©æ¶¦è®¡ç®—æ ‡ç­¾ -->
        <div id="calculator" class="tab-content active">
            <!-- è¾“å…¥å‚æ•°åŒºåŸŸ -->
            <div class="section">
                <h2 class="section-title">æˆæœ¬å‚æ•°</h2>
                
                <div class="input-group">
                    <label class="input-label">å•†å“è¿›ä»· (MY)</label>
                    <input type="number" id="cost-price" class="input-field" value="4.2" step="0.1" min="0" inputmode="decimal">
                </div>
                
                <div class="input-group">
                    <label class="input-label">å•†å“å”®ä»· (MY)</label>
                    <input type="number" id="sale-price" class="input-field" value="35.0" step="0.1" min="0" inputmode="decimal">
                </div>
                
                <div class="input-group">
                    <label class="input-label">å•†å“é‡é‡ (g)</label>
                    <input type="number" id="weight" class="input-field" value="16.9" step="0.1" min="0" inputmode="decimal">
                </div>
                
                <div class="input-group">
                    <label class="input-label">é¢„ä¼°æœˆé”€é‡</label>
                    <input type="number" id="quantity" class="input-field" value="100" step="1" min="0" inputmode="numeric">
                </div>
                
                <div class="input-group">
                    <h3 class="input-label">å®æ—¶æ±‡ç‡</h3>
                    <div class="exchange-rate-display">
                        <div id="rate-value" class="rate-value">æ­£åœ¨è·å–æ±‡ç‡...</div>
                        <div id="rate-time" class="rate-time"></div>
                    </div>
                    
                    <button id="refresh-rate" class="btn btn-secondary">åˆ·æ–°æ±‡ç‡</button>
                    
                    <div class="manual-rate">
                        <input type="number" id="manual-rate" class="input-field" value="0.66" step="0.001" min="0.1" max="2.0" inputmode="decimal" placeholder="æ‰‹åŠ¨æ±‡ç‡">
                        <button id="apply-manual-rate" class="btn btn-secondary">åº”ç”¨</button>
                    </div>
                </div>
            </div>
            
            <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
            <div class="section">
                <h2 class="section-title">åˆ©æ¶¦åˆ†æ</h2>
                
                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">æ€»æˆæœ¬</div>
                        <div id="total-cost" class="result-value">MY 0.00</div>
                        <div id="total-cost-rmb" class="result-value-secondary">Rmb 0.00</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">æ¯›åˆ©æ¶¦</div>
                        <div id="gross-profit" class="result-value">MY 0.00</div>
                        <div id="gross-profit-rmb" class="result-value-secondary">Rmb 0.00</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">æ¯›åˆ©ç‡</div>
                        <div id="profit-margin" class="result-value">0.00%</div>
                        <div></div>
                    </div>
                </div>
                
                <div class="cost-breakdown">
                    <h3 class="input-label">æˆæœ¬æ˜ç»†</h3>
                    <div class="cost-item">
                        <span>å•†å“è¿›ä»·</span>
                        <span id="cost-price-display">MY 0.00</span>
                    </div>
                    <div class="cost-item">
                        <span>ä¹‰åŠ¡ä»“é¢å•</span>
                        <span id="fixed-operation-display">MY 0.00</span>
                    </div>
                    <div class="cost-item">
                        <span>æµ·è¿ç‰©æµ</span>
                        <span id="sea-shipping-display">MY 0.00</span>
                    </div>
                    <div class="cost-item">
                        <span>å¹³å°ä½£é‡‘</span>
                        <span id="platform-commission-display">MY 0.00</span>
                    </div>
                    <div class="cost-item">
                        <span>ç‰©æµè´¹ç”¨</span>
                        <span id="shipping-display">MY 0.00</span>
                    </div>
                </div>
                
                <div class="result-grid">
                    <div class="result-item">
                        <div class="result-label">é¢„ä¼°æœˆåˆ©æ¶¦</div>
                        <div id="monthly-profit" class="result-value">MY 0.00</div>
                        <div id="monthly-profit-rmb" class="result-value-secondary">Rmb 0.00</div>
                    </div>
                    
                    <div class="result-item">
                        <div class="result-label">å•ä»¶åˆ©æ¶¦</div>
                        <div id="unit-profit" class="result-value">MY 0.00</div>
                        <div id="unit-profit-rmb" class="result-value-secondary">Rmb 0.00</div>
                    </div>
                </div>
                
                <div id="current-exchange" class="rate-time">å½“å‰æ±‡ç‡: 1 CNY = 0.6600 MYR</div>
                
                <div id="profit-level" class="profit-level">ç­‰å¾…è¾“å…¥æ•°æ®...</div>
                
                <div id="advice-box" class="advice-box">è¯·å¡«å†™å®Œæ•´çš„æˆæœ¬å‚æ•°</div>
            </div>
        </div>
        
        <!-- æ±‡ç‡æ¢ç®—æ ‡ç­¾ -->
        <div id="converter" class="tab-content">
            <div class="section">
                <h2 class="section-title">æ±‡ç‡æ¢ç®—å™¨</h2>
                
                <div class="converter-group">
                    <h3 class="converter-title">äººæ°‘å¸ â†’ é©¬å¸</h3>
                    <input type="number" id="cny-input" class="input-field" value="100" step="1" min="0" inputmode="decimal" placeholder="è¾“å…¥äººæ°‘å¸é‡‘é¢">
                    <div class="converter-result result-primary" id="cny-to-myr-result">é©¬å¸: 0.00 MYR</div>
                    <button id="convert-cny" class="btn btn-primary">æ¢ç®— â†’</button>
                </div>
                
                <div class="divider"></div>
                
                <div class="converter-group">
                    <h3 class="converter-title">é©¬å¸ â†’ äººæ°‘å¸</h3>
                    <input type="number" id="myr-input" class="input-field" value="100" step="1" min="0" inputmode="decimal" placeholder="è¾“å…¥é©¬å¸é‡‘é¢">
                    <div class="converter-result result-accent" id="myr-to-cny-result">äººæ°‘å¸: 0.00 CNY</div>
                    <button id="convert-myr" class="btn btn-accent">æ¢ç®— â†’</button>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">æ±‡ç‡ä¿¡æ¯</h2>
                <div class="exchange-rate-display">
                    <div id="converter-rate-value" class="rate-value">æ­£åœ¨è·å–æ±‡ç‡...</div>
                    <div id="converter-rate-time" class="rate-time"></div>
                </div>
                <button id="converter-refresh-rate" class="btn btn-secondary">åˆ·æ–°æ±‡ç‡</button>
            </div>
        </div>
    </div>

    <script>
        // æˆæœ¬å‚æ•°é…ç½®
        const fixedCosts = {
            fixed_operation_fee: 1.5,
            sea_shipping_rate: 0.15,
            platform_commission_rate: 0.138,
            shipping_cost: 8.31
        };

        // æ±‡ç‡é…ç½®
        let exchangeRate = 0.66;
        let lastUpdateTime = null;

        // DOMå…ƒç´ 
        const elements = {
            // æ ‡ç­¾åˆ‡æ¢
            tabs: document.querySelectorAll('.tab'),
            tabContents: document.querySelectorAll('.tab-content'),
            
            // è¾“å…¥å­—æ®µ
            costPrice: document.getElementById('cost-price'),
            salePrice: document.getElementById('sale-price'),
            weight: document.getElementById('weight'),
            quantity: document.getElementById('quantity'),
            
            // æ±‡ç‡ç›¸å…³
            rateValue: document.getElementById('rate-value'),
            rateTime: document.getElementById('rate-time'),
            refreshRate: document.getElementById('refresh-rate'),
            manualRate: document.getElementById('manual-rate'),
            applyManualRate: document.getElementById('apply-manual-rate'),
            currentExchange: document.getElementById('current-exchange'),
            converterRateValue: document.getElementById('converter-rate-value'),
            converterRateTime: document.getElementById('converter-rate-time'),
            converterRefreshRate: document.getElementById('converter-refresh-rate'),
            
            // æ¢ç®—å™¨
            cnyInput: document.getElementById('cny-input'),
            myrInput: document.getElementById('myr-input'),
            cnyToMyrResult: document.getElementById('cny-to-myr-result'),
            myrToCnyResult: document.getElementById('myr-to-cny-result'),
            convertCny: document.getElementById('convert-cny'),
            convertMyr: document.getElementById('convert-myr'),
            
            // è®¡ç®—ç»“æœ
            totalCost: document.getElementById('total-cost'),
            totalCostRmb: document.getElementById('total-cost-rmb'),
            grossProfit: document.getElementById('gross-profit'),
            grossProfitRmb: document.getElementById('gross-profit-rmb'),
            profitMargin: document.getElementById('profit-margin'),
            monthlyProfit: document.getElementById('monthly-profit'),
            monthlyProfitRmb: document.getElementById('monthly-profit-rmb'),
            unitProfit: document.getElementById('unit-profit'),
            unitProfitRmb: document.getElementById('unit-profit-rmb'),
            
            // æˆæœ¬æ˜ç»†
            costPriceDisplay: document.getElementById('cost-price-display'),
            fixedOperationDisplay: document.getElementById('fixed-operation-display'),
            seaShippingDisplay: document.getElementById('sea-shipping-display'),
            platformCommissionDisplay: document.getElementById('platform-commission-display'),
            shippingDisplay: document.getElementById('shipping-display'),
            
            // åˆ©æ¶¦ç­‰çº§å’Œå»ºè®®
            profitLevel: document.getElementById('profit-level'),
            adviceBox: document.getElementById('advice-box')
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šäº‹ä»¶
            bindEvents();
            
            // è·å–åˆå§‹æ±‡ç‡
            fetchExchangeRate();
            
            // åˆå§‹è®¡ç®—
            calculateProfit();
            
            // åˆå§‹æ¢ç®—
            convertCnyToMyr();
            convertMyrToCny();
        });

        function bindEvents() {
            // æ ‡ç­¾åˆ‡æ¢
            elements.tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // æ›´æ–°æ ‡ç­¾çŠ¶æ€
                    elements.tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // æ›´æ–°å†…å®¹æ˜¾ç¤º
                    elements.tabContents.forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // è¾“å…¥å˜åŒ–æ—¶é‡æ–°è®¡ç®—
            elements.costPrice.addEventListener('input', calculateProfit);
            elements.salePrice.addEventListener('input', calculateProfit);
            elements.weight.addEventListener('input', calculateProfit);
            elements.quantity.addEventListener('input', calculateProfit);
            
            // æ±‡ç‡ç›¸å…³äº‹ä»¶
            elements.refreshRate.addEventListener('click', fetchExchangeRate);
            elements.converterRefreshRate.addEventListener('click', fetchExchangeRate);
            elements.applyManualRate.addEventListener('click', applyManualExchangeRate);
            
            // æ¢ç®—å™¨äº‹ä»¶
            elements.convertCny.addEventListener('click', convertCnyToMyr);
            elements.convertMyr.addEventListener('click', convertMyrToCny);
            
            // è¾“å…¥æ—¶è‡ªåŠ¨æ¢ç®—ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰
            elements.cnyInput.addEventListener('input', convertCnyToMyr);
            elements.myrInput.addEventListener('input', convertMyrToCny);
        }

        // è·å–å®æ—¶æ±‡ç‡
        async function fetchExchangeRate() {
            elements.rateValue.textContent = "æ­£åœ¨è·å–æ±‡ç‡...";
            elements.converterRateValue.textContent = "æ­£åœ¨è·å–æ±‡ç‡...";
            
            try {
                // å°è¯•å¤šä¸ªæ±‡ç‡API
                const apis = [
                    "https://api.exchangerate-api.com/v4/latest/CNY",
                    "https://api.frankfurter.app/latest?from=CNY&to=MYR"
                ];
                
                let rateFound = false;
                
                for (const api of apis) {
                    try {
                        const response = await fetch(api);
                        if (response.ok) {
                            const data = await response.json();
                            const myrRate = data.rates?.MYR;
                            
                            if (myrRate) {
                                exchangeRate = myrRate;
                                rateFound = true;
                                break;
                            }
                        }
                    } catch (error) {
                        console.log(`API ${api} å¤±è´¥:`, error);
                    }
                }
                
                if (!rateFound) {
                    exchangeRate = 0.66;
                }
                
                lastUpdateTime = new Date();
                updateExchangeRateDisplay();
                
            } catch (error) {
                console.error("è·å–æ±‡ç‡å¤±è´¥:", error);
                exchangeRate = 0.66;
                lastUpdateTime = new Date();
                updateExchangeRateDisplay();
            }
        }

        function updateExchangeRateDisplay() {
            const rateText = `1 äººæ°‘å¸ = ${exchangeRate.toFixed(4)} é©¬å¸`;
            elements.rateValue.textContent = rateText;
            elements.converterRateValue.textContent = rateText;
            
            if (lastUpdateTime) {
                const timeStr = lastUpdateTime.toLocaleTimeString();
                elements.rateTime.textContent = `æ›´æ–°æ—¶é—´: ${timeStr}`;
                elements.converterRateTime.textContent = `æ›´æ–°æ—¶é—´: ${timeStr}`;
            }
            
            elements.manualRate.value = exchangeRate.toFixed(4);
            elements.currentExchange.textContent = `å½“å‰æ±‡ç‡: 1 CNY = ${exchangeRate.toFixed(4)} MYR`;
            
            calculateProfit();
            convertCnyToMyr();
            convertMyrToCny();
        }

        function applyManualExchangeRate() {
            const manualRate = parseFloat(elements.manualRate.value);
            
            if (isNaN(manualRate) || manualRate < 0.1 || manualRate > 2.0) {
                alert("è¯·è¾“å…¥åˆç†çš„æ±‡ç‡å€¼ (0.1-2.0)");
                return;
            }
            
            exchangeRate = manualRate;
            lastUpdateTime = new Date();
            updateExchangeRateDisplay();
            
            // ç§»åŠ¨ç«¯å‹å¥½æç¤º
            showToast("æ‰‹åŠ¨æ±‡ç‡å·²åº”ç”¨ï¼");
        }

        // ç§»åŠ¨ç«¯å‹å¥½æç¤º
        function showToast(message) {
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--primary);
                color: var(--dark-bg);
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 1000;
                opacity: 0;
                transition: opacity 0.3s;
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '1';
            }, 10);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 2000);
        }

        // æ±‡ç‡æ¢ç®—åŠŸèƒ½
        function convertCnyToMyr() {
            try {
                const cnyAmount = parseFloat(elements.cnyInput.value) || 0;
                const myrAmount = cnyAmount * exchangeRate;
                elements.cnyToMyrResult.textContent = `é©¬å¸: ${myrAmount.toFixed(2)} MYR`;
            } catch (error) {
                elements.cnyToMyrResult.textContent = "æ¢ç®—å¤±è´¥";
            }
        }

        function convertMyrToCny() {
            try {
                const myrAmount = parseFloat(elements.myrInput.value) || 0;
                const cnyAmount = myrAmount / exchangeRate;
                elements.myrToCnyResult.textContent = `äººæ°‘å¸: ${cnyAmount.toFixed(2)} CNY`;
            } catch (error) {
                elements.myrToCnyResult.textContent = "æ¢ç®—å¤±è´¥";
            }
        }

        // åˆ©æ¶¦è®¡ç®—åŠŸèƒ½
        function calculateProfit() {
            try {
                const costPrice = parseFloat(elements.costPrice.value) || 0;
                const salePrice = parseFloat(elements.salePrice.value) || 0;
                const weight = parseFloat(elements.weight.value) || 0;
                const quantity = parseFloat(elements.quantity.value) || 0;

                if (costPrice <= 0 || salePrice <= 0 || weight <= 0 || quantity <= 0) {
                    showWaitingState();
                    return;
                }

                // æˆæœ¬è®¡ç®—é€»è¾‘
                const fixedOperationFeeRmb = fixedCosts.fixed_operation_fee;
                const fixedOperationFeeMy = fixedOperationFeeRmb * exchangeRate;
                const seaShippingCost = (weight / 10) * fixedCosts.sea_shipping_rate;
                const shippingCost = fixedCosts.shipping_cost;
                const platformCommission = (salePrice + shippingCost) * fixedCosts.platform_commission_rate;

                const totalCost = costPrice + fixedOperationFeeMy + seaShippingCost + 
                                 platformCommission + shippingCost;

                const grossProfit = salePrice - totalCost;
                const profitMargin = salePrice > 0 ? (grossProfit / salePrice) * 100 : 0;
                const monthlyProfit = grossProfit * quantity;
                const unitProfit = grossProfit;

                // è®¡ç®—äººæ°‘å¸é‡‘é¢
                const totalCostRmb = myToRmb(totalCost);
                const grossProfitRmb = myToRmb(grossProfit);
                const monthlyProfitRmb = myToRmb(monthlyProfit);
                const unitProfitRmb = myToRmb(unitProfit);

                // æ›´æ–°ç•Œé¢æ˜¾ç¤º
                updateDisplay(
                    costPrice, fixedOperationFeeMy, seaShippingCost,
                    platformCommission, shippingCost, totalCost, 
                    grossProfit, profitMargin, monthlyProfit, unitProfit,
                    totalCostRmb, grossProfitRmb, monthlyProfitRmb, unitProfitRmb
                );

                showProfitLevel(profitMargin, grossProfit);
                showAdvice(costPrice, salePrice, grossProfit, profitMargin);

            } catch (error) {
                console.error("è®¡ç®—é”™è¯¯:", error);
            }
        }

        function myToRmb(myAmount) {
            return myAmount / exchangeRate;
        }

        function showWaitingState() {
            elements.totalCost.textContent = "MY 0.00";
            elements.totalCostRmb.textContent = "Rmb 0.00";
            elements.grossProfit.textContent = "MY 0.00";
            elements.grossProfitRmb.textContent = "Rmb 0.00";
            elements.profitMargin.textContent = "0.00%";
            elements.monthlyProfit.textContent = "MY 0.00";
            elements.monthlyProfitRmb.textContent = "Rmb 0.00";
            elements.unitProfit.textContent = "MY 0.00";
            elements.unitProfitRmb.textContent = "Rmb 0.00";
            
            elements.costPriceDisplay.textContent = "MY 0.00";
            elements.fixedOperationDisplay.textContent = "MY 0.00";
            elements.seaShippingDisplay.textContent = "MY 0.00";
            elements.platformCommissionDisplay.textContent = "MY 0.00";
            elements.shippingDisplay.textContent = "MY 0.00";
            
            elements.profitLevel.textContent = "ç­‰å¾…è¾“å…¥æ•°æ®...";
            elements.profitLevel.className = "profit-level profit-low";
            elements.adviceBox.textContent = "è¯·å¡«å†™å®Œæ•´çš„æˆæœ¬å‚æ•°";
        }

        function updateDisplay(costPrice, fixedOperationFee, seaShippingCost,
                              platformCommission, shippingCost, totalCost, 
                              grossProfit, profitMargin, monthlyProfit, unitProfit,
                              totalCostRmb, grossProfitRmb, monthlyProfitRmb, unitProfitRmb) {
            elements.totalCost.textContent = `MY ${totalCost.toFixed(2)}`;
            elements.grossProfit.textContent = `MY ${grossProfit.toFixed(2)}`;
            elements.profitMargin.textContent = `${profitMargin.toFixed(2)}%`;
            elements.monthlyProfit.textContent = `MY ${monthlyProfit.toFixed(2)}`;
            elements.unitProfit.textContent = `MY ${unitProfit.toFixed(2)}`;
            
            elements.totalCostRmb.textContent = `Rmb ${totalCostRmb.toFixed(2)}`;
            elements.grossProfitRmb.textContent = `Rmb ${grossProfitRmb.toFixed(2)}`;
            elements.monthlyProfitRmb.textContent = `Rmb ${monthlyProfitRmb.toFixed(2)}`;
            elements.unitProfitRmb.textContent = `Rmb ${unitProfitRmb.toFixed(2)}`;
            
            elements.costPriceDisplay.textContent = `MY ${costPrice.toFixed(2)}`;
            elements.fixedOperationDisplay.textContent = `MY ${fixedOperationFee.toFixed(2)}`;
            elements.seaShippingDisplay.textContent = `MY ${seaShippingCost.toFixed(2)}`;
            elements.platformCommissionDisplay.textContent = `MY ${platformCommission.toFixed(2)}`;
            elements.shippingDisplay.textContent = `MY ${shippingCost.toFixed(2)}`;
            
            if (grossProfit >= 0) {
                elements.grossProfit.classList.remove('profit-negative');
                elements.grossProfit.classList.add('profit-positive');
                elements.profitMargin.classList.remove('profit-negative');
                elements.profitMargin.classList.add('profit-positive');
                elements.grossProfitRmb.classList.remove('profit-negative');
                elements.grossProfitRmb.classList.add('profit-positive');
            } else {
                elements.grossProfit.classList.remove('profit-positive');
                elements.grossProfit.classList.add('profit-negative');
                elements.profitMargin.classList.remove('profit-positive');
                elements.profitMargin.classList.add('profit-negative');
                elements.grossProfitRmb.classList.remove('profit-positive');
                elements.grossProfitRmb.classList.add('profit-negative');
            }
        }

        function showProfitLevel(profitMargin, grossProfit) {
            let text, className;
            
            if (grossProfit < 0) {
                text = "äºæŸäº§å“ - å»ºè®®é‡æ–°å®šä»·";
                className = "profit-level profit-low";
            } else if (profitMargin >= 50) {
                text = "æé«˜åˆ©æ¶¦ - ä¼˜ç§€äº§å“";
                className = "profit-level profit-high";
            } else if (profitMargin >= 30) {
                text = "é«˜åˆ©æ¶¦ - æ¨èäº§å“";
                className = "profit-level profit-high";
            } else if (profitMargin >= 15) {
                text = "ä¸­ç­‰åˆ©æ¶¦ - å¯æ¥å—";
                className = "profit-level profit-medium";
            } else {
                text = "ä½åˆ©æ¶¦ - éœ€è¦ä¼˜åŒ–";
                className = "profit-level profit-low";
            }
            
            elements.profitLevel.textContent = text;
            elements.profitLevel.className = className;
        }

        function showAdvice(costPrice, salePrice, grossProfit, profitMargin) {
            const adviceLines = [];

            if (grossProfit < 0) {
                adviceLines.push("äº§å“äºæŸï¼šå»ºè®®æé«˜å”®ä»·æˆ–é™ä½é‡‡è´­æˆæœ¬");
            }

            if (profitMargin < 10 && grossProfit > 0) {
                adviceLines.push("åˆ©æ¶¦åä½ï¼šè€ƒè™‘ä¼˜åŒ–ä¾›åº”é“¾æˆ–è°ƒæ•´å®šä»·");
            }

            if (salePrice < costPrice * 1.5) {
                adviceLines.push("å®šä»·å»ºè®®ï¼šå”®ä»·å»ºè®®ä¸ºæˆæœ¬çš„1.5å€ä»¥ä¸Š");
            }

            if (grossProfit > 0 && profitMargin > 30) {
                adviceLines.push("ä¼˜ç§€äº§å“ï¼šç»§ç»­ä¿æŒå½“å‰çš„å®šä»·ç­–ç•¥");
            }

            if (adviceLines.length > 0) {
                elements.adviceBox.textContent = adviceLines.join("\n");
            } else {
                elements.adviceBox.textContent = "";
            }
        }
    </script>
</body>
</html>
